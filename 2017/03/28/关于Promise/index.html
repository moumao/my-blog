<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="keywords" content="某猫">
    <meta name="description" content="欢迎来到某猫のBlog,我是moumao,希望你能喜欢我的小站">
    <meta name="baidu-site-verification" content="4t9ANfuvCP" />
  <title>某猫のBlog</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="https://moumao.moumaobuchiyu.com/css/materialize.min.css">
    
      <link rel="stylesheet" href="https://moumao.moumaobuchiyu.com/css/Vateral.min.css">
    
  
  
    <style type="text/css">
        html {
            font-family: GillSans, Calibri, Trebuchet, sans-serif;
            font-weight:300;
        }
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(/fonts/MaterialIcons-Regular.eot);
            src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
        }
    </style>
<link rel="stylesheet" href="/css/prism.css" type="text/css"><script src="/js/prism.js"></script></head>
<body>
<div class="progress" >
    <div class="indeterminate"></div>
</div>
<a data-activates="slide-out"  class="button-collapse"><div class="nav-btn"><i class="material-icons">list</i></div></a>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav">
          <div class="nav-header"  style="background-image: url(https://moumao.moumaobuchiyu.com/images/head-bg.jpg)">
              <div class="header-box"><img src="https://moumao.moumaobuchiyu.com/images/header.jpg" ondragstart="return false;"></div>
              <p>某猫</p>
              <div class="nav-link">
                  
                  <a href="https://twitter.com/vaterial_moumao" target="_blank"> <div class="link-box twitter"></div></a>
                  
                  
                  <a  href="https://github.com/moumao" target="_blank"><div class="link-box github"></div></a>
                  
                  
                  <a href="mailto:1195358569@qq.com"><div class="link-box email"></div></a>
                  
                  
                  <a href="http://weibo.com/u/3168872804" target="_blank"><div class="link-box weibo"></div></a>
                  
                  
                  <a href="https://www.zhihu.com/people/mou-mao-75/activities" target="_blank"> <div class="link-box zhihu"></div></a>
                  
              </div>
              <div class="nav-search">
                  <form id="search-form"> <!-- 搜索框相关 -->
                      <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off"/>
                      <div class="nav-search-img"><i class="material-icons">search</i></div>
                  </form>
                  <div id="local-search-result"></div> <!-- 搜索结果区 -->
                  <p class='no-result'>无搜索结果</p>
              </div>
          </div>

          <!--Homepage-->
          
          <li class="nav-list">
              <a href="/" target="_self">
                  <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
              </a>
          </li>
          

          <!--archives-->
          
          <li class="nav-list dropdown-btn">
              <a  class=""  target="_self">
                  <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
              </a>
          </li>
          
          <ul class="dropdown-menu dropdown" >
              <li class="nav-dropdown-list">
                  <a class="archive-link" href="/archives/2017/04/">四月 2017<span class="archive-count">5</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/03/">三月 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/01/">一月 2017<span class="archive-count">1</span></a>
              </li>
          </ul>

          <!--categories-->
          
          <li class="nav-list dropdown-btn">
              <a   class=""  target="_self">
                  <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
              </a>
          </li>
          
          <ul class="dropdown-menu dropdown" >
              <li class="nav-dropdown-list">
                  <a class="category-link" href="/categories/hexo/">hexo<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/html/">html<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/javascript/">javascript<span class="category-count">5</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/node-js/">node.js<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/日常/">日常<span class="category-count">3</span></a>
              </li>
          </ul>

          <!--tags-->
          
          <li class="nav-list">
              <a href="/archives" target="_self">
                  <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>标签</p>
              </a>
          </li>
          
          <!--photo-->
          
          <li class="nav-list">
              <a href="/photo" target="_self">
                  <div class="nav-ico"><i class="material-icons">insert_photo</i> </div><p>影集</p>
              </a>
          </li>
          
          <!--friends-->
          
          <li class="nav-list">
              <a href="/friends" target="_self">
                  <div class="nav-ico"><i class="material-icons">face</i> </div><p>友链</p>
              </a>
          </li>
          
          <!--about-->
          
          <li class="nav-list">
              <a href="/about" target="_self">
                  <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>关于</p>
              </a>
          </li>
          
      </ul>
  </div>
</div>
<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title" style="background-image:url(https://moumao.moumaobuchiyu.com/images/random/bg9.jpg)" >
  <h2>关于Promise</h2>
    
  <p>作者:某猫 &nbsp&nbsp 发布于:<time datetime="2017-03-28T03:15:50.000Z">
          2017-03-28
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>首先设想一个日常开发常常会遇到的需求：在多个接口异步请求数据，然后利用这些数据来进行一系列的操作。一般会这样去写：</p>
<pre><code>$.ajax({
url: &#39;......&#39;,
success: function (data) {
$.ajax({
// 要在第一个请求成功后才可以执行下一步
url: &#39;......&#39;,
success: function (data) {
// ......
}
});
} });
</code></pre><p>这样的写法的原理是，当执行一些异步操作时，我们需要知道操作是否已经完成，所有当执行完成的时候会返回一个回调函数，表示操作已经完成。</p>
<p>使用回调函数的形式理解起来并不困难，但是实际的应用当中会有以下的缺点：</p>
<blockquote>
<p>1.在需要多个操作的时候，会导致多个回调函数嵌套，导致代码不够直观，就是常说的 Callback Hell。<br>2.如果几个异步操作之间并没有前后顺序之分（例如不需要前一个请求的结果作为后一个请求的参数）时，同样需要等待上一个操作完成再实行下一个操作。</p>
</blockquote>
<p>为了解决上述的问题，Promise 对象应运而生，在 EMCAScript 2015 当中已经成为标准。</p>
<h2 id="什么是-Promise"><a href="#什么是-Promise" class="headerlink" title="什么是 Promise"></a>什么是 Promise</h2><hr>
<blockquote>
<p>一个 Promise 对象可以理解为一次将要执行的操作（常常被用于异步操作），使用了 Promise<br>对象之后可以用一种链式调用的方式来组织代码，让代码更加直观。而且由于 Promise.all<br>这样的方法存在，可以让同时执行多个操作变得简单。接下来就来简单介绍 Promise 对象。</p>
</blockquote>
<p><strong>resolve 和 reject</strong></p>
<p>首先来看一段使用了 Promise 对象的代码。首先来看一段使用了 Promise 对象的代码。</p>
<pre><code>function helloWorld (ready) {
return new Promise(function (resolve, reject) {
if (ready) {
resolve(&quot;Hello World!&quot;);
} else {
reject(&quot;Good bye!&quot;);
}
});
}

helloWorld(true).then(function (message) {
alert(message);
}, function (error) {
alert(error);
});
</code></pre><p>上面的代码实现的功能非常简单，helloWord 函数接受一个参数，如果为 true 就打印 “Hello World!”，如果为 false 就打印错误的信息。helloWord 函数返回的是一个 Promise 对象。</p>
<p>在 Promise 对象当中有两个重要方法————resolve 和 reject。</p>
<p>resolve 方法可以使 Promise 对象的状态改变成成功，同时传递一个参数用于后续成功后的操作，在这个例子当中就是 Hello World! 字符串。</p>
<p>reject 方法则是将 Promise 对象的状态改变为失败，同时将错误的信息传递到后续错误处理的操作。</p>
<p><strong>Promise 的三种状态</strong></p>
<p>上面提到了 resolve 和 reject 可以改变 Promise 对象的状态，那么它究竟有哪些状态呢？</p>
<blockquote>
<p>Promise 对象有三种状态：</p>
<p>1.Fulfilled 可以理解为成功的状态<br>2.Rejected 可以理解为失败的状态 Pending 既不是 Fulfilld 也不是<br>3.Rejected 的状态，可以理解为 Promise 对象实例创建时候的初始状态</p>
</blockquote>
<p>helloWorld 的例子中的 then 方法就是根据 Promise 对象的状态来确定执行的操作，resolve 时执行第一个函数（onFulfilled），reject 时执行第二个函数（onRejected）。</p>
<p><strong>then 和 catch</strong></p>
<p><strong>then</strong></p>
<p>helloWorld 的例子当中利用了 then(onFulfilld, onRejected) 方法来执行一个任务打印 “Hello World!”，在多个任务的情况下 then 方法同样可以用一个清晰的方式完成。</p>
<pre><code>function printHello (ready) {
return new Promise(function (resolve, reject) {
if (ready) {
resolve(&quot;Hello&quot;);
} else {
reject(&quot;Good bye!&quot;);
}
});
}

function printWorld () {
alert(&quot;World&quot;);
}

function printExclamation () {
alert(&quot;!&quot;);
}

printHello(true)
.then(function(message){
alert(message);
})
.then(printWorld)
.then(printExclamation);
</code></pre><p>上述例子通过链式调用的方式，按顺序打印出了相应的内容。then 可以使用链式调用的写法原因在于，每一次执行该方法时总是会返回一个 Promise 对象。另外，在 then onFulfilled 的函数当中的返回值，可以作为后续操作的参数，因此上面的例子也可以写成：</p>
<pre><code>printHello(true).then(function (message) {
return message;
}).then(function (message) {
return message  + &#39; World&#39;;
}).then(function (message) {
return message + &#39;!&#39;;
}).then(function (message) {
alert(message);
});
</code></pre><p><strong>catch</strong><br>catch 方法是 then(onFulfilled, onRejected) 方法当中 onRejected 函数的一个简单的写法，也就是说可以写成 then(fn).catch(fn)，相当于 then(fn).then(null, fn)。使用 catch 的写法比一般的写法更加清晰明确。</p>
<pre><code>somePromise().then(function () {
return anotherPromise();
}).then(function () {
return yetAnotherPromise();
}).catch(console.log.bind(console)); // &lt;-- this is badass
</code></pre><p><strong>Promise.all 和 Promise.race</strong></p>
<p>Promise.all 可以接收一个元素为 Promise 对象的数组作为参数，当这个数组里面所有的 Promise 对象都变为 resolve 时，该方法才会返回。</p>
<pre><code>var p1 = new Promise(function (resolve) {
setTimeout(function () {
resolve(&quot;Hello&quot;);
}, 3000);
});

var p2 = new Promise(function (resolve) {
setTimeout(function () {
resolve(&quot;World&quot;);
}, 1000);
});

Promise.all([p1, p2]).then(function (result) {
console.log(result); // [&quot;Hello&quot;, &quot;World&quot;]
});
</code></pre><p>上面的例子模拟了传输两个数据需要不同的时长，虽然 p2 的速度比 p1 要快，但是 Promise.all 方法会按照数组里面的顺序将结果返回。</p>
<p>日常开发中经常会遇到这样的需求，在不同的接口请求数据然后拼合成自己所需的数据，通常这些接口之间没有关联（例如不需要前一个接口的数据作为后一个接口的参数），这个时候 Promise.all 方法就可以派上用场了。</p>
<p>还有一个和 Promise.all 相类似的方法 Promise.race，它同样接收一个数组，不同的是只要该数组中的 Promise 对象的状态发生变化（无论是 resolve 还是 reject）该方法都会返回。</p>
<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><hr>
<p><img src="https://segmentfault.com/img/bVmrXU" alt="这里写图片描述"><br>在浏览器端，一些主流的浏览器都已经可以使用 Promise 对象进行开发，在 Node.js 配合 babel 也可以很方便地使用。</p>
<p>如果要兼容旧的浏览器，建议可以寻找一些第三方的解决方案，例如 jQuery 的 $.Deferred。</p>

  </div>
 <!-- <div id="SOHUCS" style="padding:15px"></div>-->
</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2017/04/05/meta标签总结/" id="post_nav-newer" class="post-nav-content prev-content">
      新篇
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2017/03/24/JS中的回调函数/" id="post_nav-older" class="post-nav-content next-content">
      旧篇
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#什么是-Promise"><span class="post-toc-number">2.</span> <span class="post-toc-text">什么是 Promise</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#兼容性"><span class="post-toc-number">3.</span> <span class="post-toc-text">兼容性</span></a></li></ol>
</div>
<div class="post-back"><i class="material-icons">arrow_back</i></div>
<!--
<script type="text/javascript">
    (function(){
        var appid = 'cyt08XrRG';
        var conf = 'prod_87882cab5a87f3944ba07aa5bf029947';
        var width = window.innerWidth || document.documentElement.clientWidth;
        if (width < 960) {
            window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
-->

  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
      <a  id="top-button" onfocus="this.blur();"><div class="up"><i class="material-icons material-up">vertical_align_top</i></div></a>
      Copyright ©  2017  某猫のBlog<br>
      Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> && Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a>
  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="https://moumao.moumaobuchiyu.com/js/jquery-3.1.1.min.js"></script>

<script src="https://moumao.moumaobuchiyu.com/js/materialize.min.js"></script>

<script src="https://moumao.moumaobuchiyu.com/js/lazyload.min.js"></script>

<script src="https://moumao.moumaobuchiyu.com/js/jquery.rotate.min.js"></script>

<script src="https://moumao.moumaobuchiyu.com/js/Vateral.min.js"></script>




</body>
</html>
